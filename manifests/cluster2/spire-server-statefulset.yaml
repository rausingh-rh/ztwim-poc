apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: "2025-10-17T12:45:56Z"
  generation: 4
  labels:
    app.kubernetes.io/component: control-plane
    app.kubernetes.io/instance: cluster-zero-trust-workload-identity-manager
    app.kubernetes.io/managed-by: zero-trust-workload-identity-manager
    app.kubernetes.io/name: spire-server
    app.kubernetes.io/part-of: zero-trust-workload-identity-manager
    app.kubernetes.io/version: 1.12.4
  name: spire-server
  namespace: zero-trust-workload-identity-manager
  ownerReferences:
  - apiVersion: operator.openshift.io/v1alpha1
    blockOwnerDeletion: true
    controller: true
    kind: SpireServer
    name: cluster
    uid: 83b06336-b21b-4e2e-b468-539545fb1503
  resourceVersion: "123039"
  uid: c3318a18-e5e3-474a-8773-ef300b8a66ad
spec:
  persistentVolumeClaimRetentionPolicy:
    whenDeleted: Retain
    whenScaled: Retain
  podManagementPolicy: OrderedReady
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/component: control-plane
      app.kubernetes.io/instance: cluster-zero-trust-workload-identity-manager
      app.kubernetes.io/name: spire-server
  serviceName: spire-server
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/default-container: spire-server
        kubectl.kubernetes.io/restartedAt: "2025-10-17T18:26:04+05:30"
        ztwim.openshift.io/spire-controller-manager-config-hash: bd9a20a167da7bc00b2bd44acd1b08ed37a546a6cfa02de47d38772a4d1763f0
        ztwim.openshift.io/spire-server-config-hash: 13197f635ba653b0da25c1bb3f11dbbe48adcd37c1ab469902d2dae85278e794
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: control-plane
        app.kubernetes.io/instance: cluster-zero-trust-workload-identity-manager
        app.kubernetes.io/managed-by: zero-trust-workload-identity-manager
        app.kubernetes.io/name: spire-server
        app.kubernetes.io/part-of: zero-trust-workload-identity-manager
        app.kubernetes.io/version: 1.12.4
    spec:
      containers:
      - args:
        - -expandEnv
        - -config
        - /run/spire/config/server.conf
        env:
        - name: PATH
          value: /opt/spire/bin:/bin
        image: registry.redhat.io/zero-trust-workload-identity-manager/spiffe-spire-server-rhel9@sha256:9f9358798ac8aff496daa2fed09763e7bc97547fe3f3420b9de9f4d93d15b218
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 2
          httpGet:
            path: /live
            port: healthz
            scheme: HTTP
          initialDelaySeconds: 15
          periodSeconds: 60
          successThreshold: 1
          timeoutSeconds: 3
        name: spire-server
        ports:
        - containerPort: 8081
          name: grpc
          protocol: TCP
        - containerPort: 8080
          name: healthz
          protocol: TCP
        - containerPort: 8443
          name: federation
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /ready
            port: healthz
            scheme: HTTP
          initialDelaySeconds: 5
          periodSeconds: 5
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /tmp/spire-server/private
          name: spire-server-socket
        - mountPath: /run/spire/config
          name: spire-config
          readOnly: true
        - mountPath: /run/spire/data
          name: spire-data
        - mountPath: /tmp
          name: server-tmp
      - args:
        - --config=controller-manager-config.yaml
        env:
        - name: ENABLE_WEBHOOKS
          value: "true"
        image: registry.redhat.io/zero-trust-workload-identity-manager/spiffe-spire-controller-manager-rhel9@sha256:67f0e6670195c84515e7d78139a2951e463db11445740fe1d9a449a7f338556c
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /healthz
            port: healthz
            scheme: HTTP
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: spire-controller-manager
        ports:
        - containerPort: 9443
          name: https
          protocol: TCP
        - containerPort: 8083
          name: healthz
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /readyz
            port: healthz
            scheme: HTTP
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /tmp/spire-server/private
          name: spire-server-socket
          readOnly: true
        - mountPath: /controller-manager-config.yaml
          name: controller-manager-config
          readOnly: true
          subPath: controller-manager-config.yaml
        - mountPath: /tmp
          name: spire-controller-manager-tmp
          subPath: spire-controller-manager
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      serviceAccount: spire-server
      serviceAccountName: spire-server
      shareProcessNamespace: true
      terminationGracePeriodSeconds: 30
      volumes:
      - emptyDir: {}
        name: server-tmp
      - configMap:
          defaultMode: 420
          name: spire-server
        name: spire-config
      - emptyDir: {}
        name: spire-server-socket
      - emptyDir: {}
        name: spire-controller-manager-tmp
      - configMap:
          defaultMode: 420
          name: spire-controller-manager
        name: controller-manager-config
  updateStrategy:
    rollingUpdate:
      partition: 0
    type: RollingUpdate
  volumeClaimTemplates:
  - apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      creationTimestamp: null
      name: spire-data
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 2Gi
      volumeMode: Filesystem
    status:
      phase: Pending
status:
  availableReplicas: 1
  collisionCount: 0
  currentReplicas: 1
  currentRevision: spire-server-65b94c7846
  observedGeneration: 4
  readyReplicas: 1
  replicas: 1
  updateRevision: spire-server-65b94c7846
  updatedReplicas: 1
